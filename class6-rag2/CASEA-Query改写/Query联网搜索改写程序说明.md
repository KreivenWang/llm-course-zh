# Query联网搜索改写程序说明文档

## 程序概述

这是一个使用Ollama模型实现的智能Query分析与搜索策略生成程序。它能够分析用户的查询，判断是否需要联网搜索，并对查询进行改写以适应搜索引擎，同时生成详细的搜索策略建议。注意：该程序本身不执行实际的联网搜索，而是提供搜索策略和改写建议，以便其他组件可以使用这些建议执行实际的搜索操作。

## 主要功能

### 1. 搜索需求分析
- 识别8类需要实时数据的查询：
  - 时效性信息（包含"最新"、"今天"、"现在"等词汇）
  - 价格信息（包含"多少钱"、"价格"等词汇）
  - 营业信息（包含"营业时间"、"开放时间"等）
  - 活动信息（包含"活动"、"表演"等）
  - 天气信息（包含"天气"、"下雨"等）
  - 交通信息（包含"怎么去"、"交通"等）
  - 预订信息（包含"预订"、"预约"等）
  - 实时状态（包含"排队"、"拥挤"等）

### 2. Query改写功能
- 将原始查询改写为更适合搜索引擎的格式
- 提取关键词组合
- 明确搜索意图
- 建议搜索来源

### 3. 搜索策略生成
- 生成主要搜索关键词
- 提供扩展搜索词汇
- 推荐搜索平台
- 指定时间范围

**注意：程序本身不执行实际的网络请求或搜索操作，它只生成用于搜索的策略和建议。**

## 核心类与方法

### WebSearchQueryRewriter类

#### `identify_web_search_needs(query, conversation_history)`
- 分析查询是否需要联网搜索
- 返回是否需要搜索、原因和置信度

#### `rewrite_for_web_search(query, search_type)`
- 对查询进行改写优化
- 返回改写后的查询和相关搜索信息

#### `generate_search_strategy(query, search_type)`
- 生成完整的搜索策略
- 包括关键词、平台、时间范围等

#### `auto_web_search_rewrite(query, conversation_history)`
- 主要的自动处理方法
- 结合前述三个功能完成完整的分析流程

## 技术实现

### 使用的模型
- 使用Ollama的qwen3:14b模型进行文本生成
- 通过langchain_ollama库进行模型交互

### 输入输出格式
- 所有AI响应均以JSON格式返回
- 便于程序解析和使用

## 使用示例

程序包含两个示例：
1. 时效性信息查询："上海迪士尼乐园今天开放吗？现在人多不多？"
2. 价格和预订信息查询："下周六的门票多少钱？需要提前多久预订？"

对于每个查询，程序会输出：
- 是否需要联网搜索
- 搜索原因和置信度
- 改写后的查询
- 搜索关键词和意图
- 建议的搜索来源
- 详细的搜索策略

**重要说明：此程序只生成搜索策略，不执行实际的网络搜索。要实现实际的联网搜索功能，需要结合其他工具（如requests库、Google搜索API等）来执行生成的搜索策略。**